const nobleGases = new Set([2, 10, 18, 36, 54, 86, 118]);
const metalloids = new Set([5, 14, 32, 33, 51, 52]);
const nonmetals = new Set([1, 6, 7, 8, 9, 15, 16, 17, 34, 35, 53]);

const elements = [
  [1, 'H', 'Водород', 1.008, [1]],
  [2, 'He', 'Гелий', 4.003, [2]],
  [3, 'Li', 'Литий', 6.94, [2,1]],
  [4, 'Be', 'Бериллий', 9.012, [2,2]],
  [5, 'B', 'Бор', 10.81, [2,3]],
  [6, 'C', 'Углерод', 12.011, [2,4]],
  [7, 'N', 'Азот', 14.007, [2,5]],
  [8, 'O', 'Кислород', 15.999, [2,6]],
  [9, 'F', 'Фтор', 18.998, [2,7]],
  [10, 'Ne', 'Неон', 20.180, [2,8]],
  [11, 'Na', 'Натрий', 22.99, [2,8,1]],
  [12, 'Mg', 'Магний', 24.305, [2,8,2]],
  [13, 'Al', 'Алюминий', 26.982, [2,8,3]],
  [14, 'Si', 'Кремний', 28.085, [2,8,4]],
  [15, 'P', 'Фосфор', 30.974, [2,8,5]],
  [16, 'S', 'Сера', 32.06, [2,8,6]],
  [17, 'Cl', 'Хлор', 35.45, [2,8,7]],
  [18, 'Ar', 'Аргон', 39.948, [2,8,8]],
  [19, 'K', 'Калий', 39.098, [2,8,8,1]],
  [20, 'Ca', 'Кальций', 40.08, [2,8,8,2]],
  [21, 'Sc', 'Скандий', 44.956, [2,8,9,2]],
  [22, 'Ti', 'Титан', 47.867, [2,8,10,2]],
  [23, 'V', 'Ванадий', 50.942, [2,8,11,2]],
  [24, 'Cr', 'Хром', 51.996, [2,8,13,1]],
  [25, 'Mn', 'Марганец', 54.938, [2,8,13,2]],
  [26, 'Fe', 'Железо', 55.845, [2,8,14,2]],
  [27, 'Co', 'Кобальт', 58.933, [2,8,15,2]],
  [28, 'Ni', 'Никель', 58.69, [2,8,16,2]],
  [29, 'Cu', 'Медь', 63.55, [2,8,18,1]],
  [30, 'Zn', 'Цинк', 65.38, [2,8,18,2]],
  [31, 'Ga', 'Галлий', 69.723, [2,8,18,3]],
  [32, 'Ge', 'Германий', 72.63, [2,8,18,4]],
  [33, 'As', 'Мышьяк', 74.922, [2,8,18,5]],
  [34, 'Se', 'Селен', 78.971, [2,8,18,6]],
  [35, 'Br', 'Бром', 79.904, [2,8,18,7]],
  [36, 'Kr', 'Криптон', 83.798, [2,8,18,8]],
  [37, 'Rb', 'Рубидий', 85.468, [2,8,18,8,1]],
  [38, 'Sr', 'Стронций', 87.62, [2,8,18,8,2]],
  [39, 'Y', 'Иттрий', 88.906, [2,8,18,9,2]],
  [40, 'Zr', 'Цирконий', 91.224, [2,8,18,10,2]],
  [41, 'Nb', 'Ниобий', 92.906, [2,8,18,12,1]],
  [42, 'Mo', 'Молибден', 95.95, [2,8,18,13,1]],
  [43, 'Tc', 'Технеций', 98, [2,8,18,13,2]],
  [44, 'Ru', 'Рутений', 101.07, [2,8,18,15,1]],
  [45, 'Rh', 'Родий', 102.91, [2,8,18,16,1]],
  [46, 'Pd', 'Палладий', 106.42, [2,8,18,18,0]],
  [47, 'Ag', 'Серебро', 107.87, [2,8,18,18,1]],
  [48, 'Cd', 'Кадмий', 112.41, [2,8,18,18,2]],
  [49, 'In', 'Индий', 114.82, [2,8,18,18,3]],
  [50, 'Sn', 'Олово', 118.71, [2,8,18,18,4]],
  [51, 'Sb', 'Сурьма', 121.76, [2,8,18,18,5]],
  [52, 'Te', 'Теллур', 127.60, [2,8,18,18,6]],
  [53, 'I', 'Йод', 126.90, [2,8,18,18,7]],
  [54, 'Xe', 'Ксенон', 131.29, [2,8,18,18,8]],
  [55, 'Cs', 'Цезий', 132.91, [2,8,18,18,8,1]],
  [56, 'Ba', 'Барий', 137.33, [2,8,18,18,8,2]],
  [57, 'La', 'Лантан', 138.91, [2,8,18,18,9,2]],
  [58, 'Ce', 'Церий', 140.12, [2,8,18,19,9,2]],
  [59, 'Pr', 'Празеодим', 140.91, [2,8,18,21,8,2]],
  [60, 'Nd', 'Неодим', 144.24, [2,8,18,22,8,2]],
  [61, 'Pm', 'Прометий', 145, [2,8,18,23,8,2]],
  [62, 'Sm', 'Самарий', 150.36, [2,8,18,24,8,2]],
  [63, 'Eu', 'Европий', 151.96, [2,8,18,25,8,2]],
  [64, 'Gd', 'Гадолиний', 157.25, [2,8,18,25,9,2]],
  [65, 'Tb', 'Тербий', 158.93, [2,8,18,27,8,2]],
  [66, 'Dy', 'Диспрозий', 162.50, [2,8,18,28,8,2]],
  [67, 'Ho', 'Гольмий', 164.93, [2,8,18,29,8,2]],
  [68, 'Er', 'Эрбий', 167.26, [2,8,18,30,8,2]],
  [69, 'Tm', 'Тулий', 168.93, [2,8,18,31,8,2]],
  [70, 'Yb', 'Иттербий', 173.05, [2,8,18,32,8,2]],
  [71, 'Lu', 'Лютеций', 174.97, [2,8,18,32,9,2]],
  [72, 'Hf', 'Гафний', 178.49, [2,8,18,32,10,2]],
  [73, 'Ta', 'Тантал', 180.95, [2,8,18,32,11,2]],
  [74, 'W', 'Вольфрам', 183.84, [2,8,18,32,12,2]],
  [75, 'Re', 'Рений', 186.21, [2,8,18,32,13,2]],
  [76, 'Os', 'Осмий', 190.23, [2,8,18,32,14,2]],
  [77, 'Ir', 'Иридий', 192.22, [2,8,18,32,15,2]],
  [78, 'Pt', 'Платина', 195.08, [2,8,18,32,17,1]],
  [79, 'Au', 'Золото', 196.97, [2,8,18,32,18,1]],
  [80, 'Hg', 'Ртуть', 200.59, [2,8,18,32,18,2]],
  [81, 'Tl', 'Таллий', 204.38, [2,8,18,32,18,3]],
  [82, 'Pb', 'Свинец', 207.2, [2,8,18,32,18,4]],
  [83, 'Bi', 'Висмут', 208.98, [2,8,18,32,18,5]],
  [84, 'Po', 'Полоний', 209, [2,8,18,32,18,6]],
  [85, 'At', 'Астат', 210, [2,8,18,32,18,7]],
  [86, 'Rn', 'Радон', 222, [2,8,18,32,18,8]],
  [87, 'Fr', 'Франций', 223, [2,8,18,32,18,8,1]],
  [88, 'Ra', 'Радий', 226, [2,8,18,32,18,8,2]],
  [89, 'Ac', 'Актиний', 227, [2,8,18,32,18,9,2]],
  [90, 'Th', 'Торий', 232.04, [2,8,18,32,18,10,2]],
  [91, 'Pa', 'Протактиний', 231.04, [2,8,18,32,20,9,2]],
  [92, 'U', 'Уран', 238.03, [2,8,18,32,21,9,2]],
  [93, 'Np', 'Нептуний', 237, [2,8,18,32,22,9,2]],
  [94, 'Pu', 'Плутоний', 244, [2,8,18,32,24,8,2]],
  [95, 'Am', 'Америций', 243, [2,8,18,32,25,8,2]],
  [96, 'Cm', 'Кюрий', 247, [2,8,18,32,25,9,2]],
  [97, 'Bk', 'Берклий', 247, [2,8,18,32,27,8,2]],
  [98, 'Cf', 'Калифорний', 251, [2,8,18,32,28,8,2]],
  [99, 'Es', 'Эйнштейний', 252, [2,8,18,32,29,8,2]],
  [100, 'Fm', 'Фермий', 257, [2,8,18,32,30,8,2]],
  [101, 'Md', 'Менделевий', 258, [2,8,18,32,31,8,2]],
  [102, 'No', 'Нобелий', 259, [2,8,18,32,32,8,2]],
  [103, 'Lr', 'Лоуренсий', 266, [2,8,18,32,32,8,3]],
  [104, 'Rf', 'Резерфордий', 267, [2,8,18,32,32,10,2]],
  [105, 'Db', 'Дубний', 268, [2,8,18,32,32,11,2]],
  [106, 'Sg', 'Сиборгий', 269, [2,8,18,32,32,12,2]],
  [107, 'Bh', 'Борий', 270, [2,8,18,32,32,13,2]],
  [108, 'Hs', 'Хассий', 277, [2,8,18,32,32,14,2]],
  [109, 'Mt', 'Мейтнерий', 278, [2,8,18,32,32,15,2]],
  [110, 'Ds', 'Дармштадтий', 281, [2,8,18,32,32,16,2]],
  [111, 'Rg', 'Рентгений', 282, [2,8,18,32,32,17,2]],
  [112, 'Cn', 'Коперниций', 285, [2,8,18,32,32,18,2]],
  [113, 'Nh', 'Нихоний', 286, [2,8,18,32,32,18,3]],
  [114, 'Fl', 'Флеровий', 289, [2,8,18,32,32,18,4]],
  [115, 'Mc', 'Московий', 290, [2,8,18,32,32,18,5]],
  [116, 'Lv', 'Ливерморий', 293, [2,8,18,32,32,18,6]],
  [117, 'Ts', 'Теннессин', 294, [2,8,18,32,32,18,7]],
  [118, 'Og', 'Оганесон', 294, [2,8,18,32,32,18,8]]
];

const elementMap = {};
for (const [num, sym, name, mass, shells] of elements) {
  let type = 'metal';
  if (nobleGases.has(num)) type = 'noble-gas';
  else if (metalloids.has(num)) type = 'metalloid';
  else if (nonmetals.has(num)) type = 'nonmetal';
  else if ((num >= 57 && num <= 71) || (num >= 89 && num <= 103)) type = 'f-element';
  elementMap[num] = { number: num, symbol: sym, name: name, mass, shells, type };
}

function getTypeLabel(type) {
  const labels = {
    'metal': 'Металл',
    'metalloid': 'Полуметалл',
    'nonmetal': 'Неметалл',
    'noble-gas': 'Инертный газ',
    'f-element': 'Лантаноид / Актиноид'
  };
  return labels[type] || 'Неизвестно';
}

const mainPeriods = [
  [1, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, 2],
  [3, 4, null, null, null, null, null, null, null, null, null, null, 5, 6, 7, 8, 9, 10],
  [11, 12, null, null, null, null, null, null, null, null, null, null, 13, 14, 15, 16, 17, 18],
  [19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36],
  [37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 52, 53, 54],
  [55, 56, 57, 72, 73, 74, 75, 76, 77, 78, 79, 80, 81, 82, 83, 84, 85, 86],
  [87, 88, 89, 104, 105, 106, 107, 108, 109, 110, 111, 112, 113, 114, 115, 116, 117, 118]
];

const lanthanides = Array.from({ length: 15 }, (_, i) => 57 + i);
const actinides = Array.from({ length: 15 }, (_, i) => 89 + i);

function hideAllTooltips() {
  document.querySelectorAll('.tooltip.show').forEach(el => el.classList.remove('show'));
}

document.addEventListener('click', e => {
  if (!e.target.closest('.cell:not(.empty)')) hideAllTooltips();
});

function createElementCell(number) {
  const cell = document.createElement('div');
  if (number === null) {
    cell.classList.add('cell', 'empty');
    return cell;
  }

  const el = elementMap[number];
  if (!el) {
    cell.classList.add('cell', 'empty');
    cell.textContent = '?';
    return cell;
  }

  const shellsStr = el.shells.join(', ');
  const typeLabel = getTypeLabel(el.type);
  const massRounded = parseFloat(el.mass.toFixed(3)).toString();

  cell.classList.add('cell', el.type);
  cell.innerHTML = `
    <div class="number">${el.number}</div>
    <div class="symbol">${el.symbol}</div>
    <div class="name">${el.name}</div>
    <div class="mass">${el.mass}</div>
    <div class="shells">${shellsStr}</div>
    <a href="https://square-o-bear.github.io/chemistry-notes-with-search.github.io/atom/elements/${el.symbol}.html" class="tooltip">
      <strong>${el.name} (${el.symbol})</strong><br>
      № ${el.number}<br>
      Атомная масса: ${massRounded}<br>
      Эл. оболочки: ${shellsStr}<br>
      Тип: ${typeLabel}
    </a>
  `;

  const tooltip = cell.querySelector('.tooltip');
  cell.addEventListener('click', event => {
    event.stopPropagation();
    if (tooltip.classList.contains('show')) {
      tooltip.classList.remove('show');
    } else {
      hideAllTooltips();
      tooltip.classList.add('show');
    }
  });

  return cell;
}

const mainTable = document.getElementById('mainTable');
mainPeriods.flat().forEach(num => mainTable.appendChild(createElementCell(num)));

const lanth = document.getElementById('lanthanides');
lanthanides.forEach(num => lanth.appendChild(createElementCell(num)));

const actin = document.getElementById('actinides');
actinides.forEach(num => actin.appendChild(createElementCell(num)));